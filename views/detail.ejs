<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail Page</title>
    <link href="/main.css" rel = "stylesheet">
</head>
<body class="grey-bg">

    <%- include('nav.ejs') %>
    <%= JSON.stringify(result) %>
    
    <div class>
        <p>디테일</p>
    </div>

    <% for (let i = 0 ; i < result.content.length; i++){ %>

    <div class="white-bg">
        <div class="list-box">
            <h4><%= result.content[i] %>
            <a href="/edit/<%= encodeURIComponent(result.content[i]) %>">
              <span class="edit" data-content="<%= encodeURIComponent(result.content[i]) %>" data-id="<%= result._id %>">✏️</span>
            </a>
            <span class="delete" data-content="<%= encodeURIComponent(result.content[i]) %>" data-id="<%= result._id %>">🗑️</span>
              <p><%= i %></p>
            </h4>
        </div>
    </div>

    <% } %>

    
<script>
  document.querySelectorAll('.delete').forEach(element =>{
    element.addEventListener('click', function(e){
    // e.target.dataset.id
    const doccontent = encodeURIComponent(e.target.dataset.content)
    const id = encodeURIComponent(e.target.dataset.id)

    fetch(`/delete?doccontent=${doccontent}&id=${id}`,{
      method : 'DELETE'
    })
    .then(response => response.text())
    .then(result=> {
      location.reload()
      console.log(result)
    })
    .catch(error => console.error(error))
  }) 
})
</script>


<script>
  document.querySelectorAll('.edit')[0].addEventListener('click', function(){
    fetch('/edit?docdate=' + e.target.dataset.date, {
      method : 'POST',
      headers:{
        'Context=Type' : 'application/json'
      },
      body : JSON.stringify({todo : 요청.body.todo[0]})
    })
  })
</script>

</body>
</html>


   
</body>
</html>
