<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail Page</title>
    <link href="/main.css" rel = "stylesheet">
</head>
<body class="grey-bg">

    <%- include('nav.ejs') %>
    <%= JSON.stringify(result) %>
    
    <div class>
        <p>디테일</p>
    </div>

    <% for (let i = 0 ; i < result.content.length; i++){ %>

    <div class="white-bg">
        <div class="list-box">
            <h4><%= result.content[i] %>
            <span class="delete" data-content="<%= encodeURIComponent(result.content[i]) %>" data-id="<%= result._id %>">🗑️</span>
            <span class="add" data-content="<%= encodeURIComponent(result.content[i]) %>" data-id="<%= result._id %>">'추가'</span> 
            </h4>
        </div>
    </div>

    <div class="white-bg">
      <input type="text" id="edit-content-<%= i %>" placeholder="수정사항 입력">
      <button class="edit" data-index="<%= i %>" data-id="<%= result._id %>" id="edit-button-<%= i %>">✏️</button>
    </div>
  <% } %>

    
<script>
  document.querySelectorAll('.delete').forEach(element =>{
    element.addEventListener('click', function(e){
    // e.target.dataset.id
    const doccontent = encodeURIComponent(e.target.dataset.content)
    const id = encodeURIComponent(e.target.dataset.id)

    fetch(`/delete?doccontent=${doccontent}&id=${id}`,{
      method : 'DELETE'
    })
    .then(response => response.text())
    .then(result=> {
      location.reload()
      console.log(result)
    })
    .catch(error => console.error(error))
  }) 
})
</script>


<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.edit').forEach(element => {
      element.addEventListener('click', function(e) {
        console.log('버튼 클릭됨');


        const newContent = document.getElementById(`edit-content-${index}`).value;
        
        console.log('보낼 데이터:', { id: e.target.dataset.id, index: e.target.dataset.index, content: newContent });

        fetch('/edit', {
          method: 'PATCH',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            id: e.target.dataset.id,
            index: e.target.dataset.index,
            content: encodeURIComponent(newContent)
          })
        })
        .then((response) => response.text())
        .then((data) => {
          location.reload()
          console.log('응답 데이터:', data);
        })
        .catch(error => {
          console.log('에러:', error);
        });
      });
    });
  });
</script>
</body>
</html>